---
title: "TanStack Queryã§ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ã«åˆã‚ã›ã¦åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã™ã‚‹"
emoji: "ğŸ¶"
type: "tech"
topics: ["Tanstack Query", "React Query", "React"]
published: true
---
## èƒŒæ™¯

ä¾‹ãˆã°TODOã‚¢ãƒ—ãƒªã‚’æƒ³å®šã—ãŸã¨ãã«ã€TODOã®è¿½åŠ ã«åˆã‚ã›ã¦TODOãƒªã‚¹ãƒˆã‚’æ›´æ–°ï¼ˆå†å–å¾—ï¼‰ã—ãŸã„ã¨ã„ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ï¼ˆTODOã‚’è¿½åŠ ï¼‰ã—ãŸã¨ãã«ã€ãã‚Œã«ã¨ã‚‚ãªã†åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆTODOãƒªã‚¹ãƒˆï¼‰ã‚’æ›´æ–°ã—ãªã„ã¨ViewãŒå¤ããªã£ã¦ã—ã¾ã†ä¸€ä¾‹ã§ã™ã€‚

## useMutationã®onSuccessã§invalidateQueriesã‚’å®Ÿè¡Œã™ã‚‹

`invalidateQueries`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå¤ããªã£ãŸã¨ã¿ãªã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã‚Œã‚’`useMutation`ã®`onSuccess`ãƒ¡ã‚½ãƒƒãƒ‰ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ãƒ„ã‚¤ãƒ¼ãƒˆã«åˆã‚ã›ã¦ãƒ„ã‚¤ãƒ¼ãƒˆä¸€è¦§ã‚’å†å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
import { useMutation, useQueryClient } from '@tanstack/react-query';

const queryClient = useQueryClient();

const todos = useQuery({ queryKey: ['todos'], queryFn: fetchTodos })

const mutation = useMutation({
  mutationFn: addTodo,
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['todos'] });
  },
})
```

`addTodo`ãŒæˆåŠŸã—ãŸã¨ãã«`todos`ã¨ã„ã†ã‚­ãƒ¼ãŒæŒ‡å®šã•ã‚ŒãŸã‚¯ã‚¨ãƒªã‚’å†å–å¾—ã—ã¾ã™ã€‚

ã¡ãªã¿ã«ã§ã™ãŒã€`invalidateQueries`ã«æŒ‡å®šã™ã‚‹ã‚¯ã‚¨ãƒªã¯ã€è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚’éƒ¨åˆ†ä¸€è‡´ã§ãƒãƒƒãƒã•ã›ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€`todos`ã¨ã„ã†æ¥é ­è¾ã‚’ä½¿ã£ã¦ã€`todos`ã§å§‹ã¾ã‚‹ã‚¯ã‚¨ãƒªã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå¤ããªã£ãŸã¨ã¿ãªã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
import { useQuery, useQueryClient } from '@tanstack/react-query'

const queryClient = useQueryClient()

queryClient.invalidateQueries({ queryKey: ['todos'] })

// Both queries below will be invalidated
const todoListQuery = useQuery({
  queryKey: ['todos'],
  queryFn: fetchTodoList,
})
const todoListQuery = useQuery({
  queryKey: ['todos', { page: 1 }],
  queryFn: fetchTodoList,
})
```

## å‚è€ƒ

https://tanstack.com/query/v4/docs/react/guides/invalidations-from-mutations